{% extends "base.html" %}
{% block content %}
<h2>Anneal QA — {{ header.lot_no }}</h2>

<div class="toolbar" style="margin:10px 0; display:flex; gap:8px; flex-wrap:wrap">
  <a class="btn" href="/qa-dashboard">← Back to QA Dashboard</a>
  <a class="btn" href="/anneal/lots">Anneal Lots</a>
  <a class="btn" href="/anneal/trace/{{ header.id }}" target="_blank">Trace</a>
  <a class="btn" href="/anneal/pdf/{{ header.id }}" target="_blank">PDF</a>
</div>

<p class="muted">
  Date: {{ header.date }} |
  Grade: {{ header.grade }} |
  Weight: {{ '%.0f'|format(header.weight_kg or 0) }} kg |
  Ammonia: {{ '%.2f'|format(header.ammonia_kg or 0) }} kg
</p>

<form method="post" action="/anneal/qa/{{ header.id }}">
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px">
    <div>
      <h3>Chemistry</h3>
      <table class="table" style="width:auto">
        <tr>
          <th>C</th><td><input name="C"   value="{{ chem.C }}"></td>
          <th>Si</th><td><input name="Si" value="{{ chem.Si }}"></td>
        </tr>
        <tr>
          <th>S</th><td><input name="S"   value="{{ chem.S }}"></td>
          <th>P</th><td><input name="P"   value="{{ chem.P }}"></td>
        </tr>
        <tr>
          <th>Cu</th><td><input name="Cu" value="{{ chem.Cu }}"></td>
          <th>Ni</th><td><input name="Ni" value="{{ chem.Ni }}"></td>
        </tr>
        <tr>
          <th>Mn</th><td><input name="Mn" value="{{ chem.Mn }}"></td>
          <th>Fe</th><td><input name="Fe" value="{{ chem.Fe }}"></td>
        </tr>
      </table>
    </div>

    <div>
      <h3>Physical / PSD</h3>
      <table class="table" style="width:auto">
        <tr>
          <th>AD</th><td><input name="ad"   value="{{ phys.ad }}"></td>
          <th>Flow</th><td><input name="flow" value="{{ phys.flow }}"></td>
        </tr>
      </table>

      <h4 style="margin-top:10px">PSD</h4>
      <table class="table" style="width:auto">
        <tr><th>+212</th><td><input name="p212" value="{{ psd.p212 }}"></td></tr>
        <tr><th>+180</th><td><input name="p180" value="{{ psd.p180 }}"></td></tr>
        <tr><th>-180+150</th><td><input name="n180p150" value="{{ psd.n180p150 }}"></td></tr>
        <tr><th>-150+75</th><td><input name="n150p75"  value="{{ psd.n150p75 }}"></td></tr>
        <tr><th>-75+45</th><td><input name="n75p45"   value="{{ psd.n75p45 }}"></td></tr>
        <tr><th>-45</th><td><input name="n45"        value="{{ psd.n45 }}"></td></tr>
      </table>
    </div>
  </div>

  <div style="margin-top:12px">
    <h3>Anneal-specific</h3>
    <table class="table" style="width:auto">
      <tr>
        <th>Oxygen</th>
        <td><input name="oxygen" value="{{ qa.oxygen or '' }}"></td>
        <th>Decision</th>
        <td>
          <select name="decision">
            {% set dec = (qa.decision or 'APPROVED')|upper %}
            <option value="APPROVED" {{ 'selected' if dec=='APPROVED' else '' }}>APPROVED</option>
            <option value="HOLD"      {{ 'selected' if dec=='HOLD' else '' }}>HOLD</option>
            <option value="REJECTED"  {{ 'selected' if dec=='REJECTED' else '' }}>REJECTED</option>
            <option value="PENDING"   {{ 'selected' if dec=='PENDING' else '' }}>PENDING</option>
          </select>
        </td>
      </tr>
      <tr>
        <th>Remarks</th>
        <td colspan="3"><input name="remarks" style="width:100%" value="{{ qa.remarks or '' }}"></td>
      </tr>
    </table>
  </div>

  <div style="margin-top:12px">
    <button class="btn" type="submit">Save QA</button>
    <a class="btn" href="/qa-dashboard">Cancel</a>
  </div>
</form>

<style>
  .muted{color:#6b7280}
  .table{border-collapse:collapse}
  .table th,.table td{border:1px solid #e5e7eb; padding:6px 8px}
  input{padding:6px 8px; min-width:120px}
  .btn{padding:8px 14px; background:#111827; color:#fff; border-radius:8px; text-decoration:none; border:0}
</style>
{% endblock %}
