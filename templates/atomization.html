<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Atomization – New Lot</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif; margin:20px;}
    table{border-collapse:collapse; width:100%;}
    th,td{border:1px solid #e5e7eb; padding:8px; text-align:left;}
    th{background:#f3f4f6}
    .badge{display:inline-block; padding:2px 8px; border-radius:12px; font-size:12px; color:#fff}
    .badge-success{background:#16a34a}
    .badge-info{background:#0ea5e9}
    .actions a{display:inline-block; margin-right:6px; padding:4px 8px; border:1px solid #d1d5db; border-radius:6px; text-decoration:none}
    .btn{padding:8px 14px; border-radius:8px; background:#111827; color:#fff; text-decoration:none; border:none}
    input[type=number]{width:120px}
    a.btn-link{display:inline-block;margin-bottom:10px}
  </style>
</head>
<body>
  <h1>Atomization – New Lot</h1>
  <p><a class="btn-link" href="/">Home</a></p>

  <form method="post" action="/atomization/new">
    <label>Lot Weight (kg): </label>
    <input type="number" step="0.1" name="lot_weight" value="3000" />

    <h2>Allocate Quantity From Approved Heats</h2>
    <p>Enter the kg to take from each heat (you can split a heat across multiple lots).</p>

    <table>
      <thead>
        <tr>
          <th>Heat</th>
          <th>Type</th>
          <th>Available (kg)</th>
          <th>Allocate (kg)</th>
          <th>Heat Unit Cost</th>
        </tr>
      </thead>
      <tbody>
      {% for h in heats %}
        <tr>
          <td>{{ h.heat_no }}</td>
          <td>
            {% set g = heat_grades.get(h.id) %}
            {% if g == 'KRFS' %}<span class="badge badge-info">KRFS (FeSi)</span>
            {% else %}<span class="badge badge-success">KRIP</span>{% endif %}
          </td>
          <td>{{ '%.1f' % (available_map.get(h.id, 0.0)) }}</td>
          <td><input type="number" step="0.1" min="0" max="{{ available_map.get(h.id, 0.0) }}" name="alloc_{{ h.id }}" value="0.0"/></td>
          <td>₹ {{ '%.2f' % (h.unit_cost or 0.0) }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <p style="margin-top:10px"><button class="btn" type="submit">Create Lot</button></p>
  </form>

  <h2>Lots</h2>
  <table>
    <thead>
      <tr><th>Lot</th><th>Grade</th><th>Weight</th><th>Unit Cost</th><th>QA</th><th>Remarks</th><th>Actions</th></tr>
    </thead>
    <tbody>
      {% for lot in lots %}
        <tr>
          <td>{{ lot.lot_no }}</td>
          <td>{{ lot.grade }}</td>
          <td>{{ '%.1f' % (lot.weight or 0) }}</td>
          <td>₹ {{ '%.2f' % (lot.unit_cost or 0) }}</td>
          <td>{{ lot.qa_status }}</td>
          <td>{{ lot.qa_remarks or '' }}</td>
          <td class="actions">
            <a href="/qa/lot/{{ lot.id }}">QA</a>
            <a href="/traceability/lot/{{ lot.id }}">Trace</a>
            <a href="/pdf/lot/{{ lot.id }}">PDF</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
