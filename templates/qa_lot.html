<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>QA – Lot</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:20px}
    .brand{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .brand .name{font-weight:600;font-size:22px;margin:0}
    .brand img{height:40px}
    .badge{display:inline-block;padding:2px 8px;border-radius:12px;font-size:12px;color:#fff}
    .badge-success{background:#16a34a}
    .badge-info{background:#0ea5e9}
    .sec{margin-top:16px}
    label{display:block;margin-top:6px}
    input{padding:4px 6px}
    .grid{display:grid;grid-template-columns:repeat(4,minmax(140px,1fr));gap:10px}
    .btn{margin-top:16px;padding:8px 14px;border-radius:8px;background:#111827;color:#fff;border:none}
    a.btn-link{display:inline-block;margin-bottom:10px}
    .muted{color:#6b7280;font-size:12px}
  </style>
  <script>
    function validateNumericRequiredPositive(form){
      const nums = form.querySelectorAll('input[type="number"][required]');
      for (const el of nums){
        const v = parseFloat(el.value);
        if (!isFinite(v) || v <= 0){
          alert("All fields must be numeric decimals greater than 0.");
          el.focus();
          return false;
        }
      }
      return true;
    }
  </script>
</head>
<body>
  <div class="brand">
    <div class="name">KRN Alloys Pvt. Ltd</div>
    <img src="/static/KRN_Logo.png" alt="KRN">
  </div>

  <h2>QA – Lot {{ lot.lot_no }}
    {% if grade == 'KRFS' %}<span class="badge badge-info">KRFS (FeSi)</span>
    {% else %}<span class="badge badge-success">KRIP</span>{% endif %}
  </h2>
  <p class="muted">Chemistry below is pre-filled by server: dominant heat (&ge;60%) else allocation-weighted average.</p>
  <p><a class="btn-link" href="/qa-dashboard">Back</a></p>

  <form method="post" onsubmit="return validateNumericRequiredPositive(this)">
    <div class="sec">
      <h3>Chemistry</h3>
      <div class="grid">
        {% for k,v in chem.items() %}
        <div>
          <label>{{ k }}</label>
          <input type="number" name="{{ k }}" value="{{ v }}" step="0.001" min="0.0001" required>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="sec">
      <h3>Physical</h3>
      <label>AD</label>
      <input type="number" name="ad" value="{{ phys.ad }}" step="0.001" min="0.0001" required>
      <label>Flow</label>
      <input type="number" name="flow" value="{{ phys.flow }}" step="0.001" min="0.0001" required>
    </div>

    <div class="sec">
      <h3>PSD</h3>
      <div class="grid">
        {% for k,v in psd.items() %}
        <div>
          <label>{{ k }}</label>
          <input type="number" name="{{ k }}" value="{{ v }}" step="0.001" min="0.0001" required>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="sec">
      <label>Decision</label>
      <select name="decision">
        <option value="APPROVED" {% if lot.qa_status=='APPROVED' %}selected{% endif %}>APPROVED</option>
        <option value="REJECTED" {% if lot.qa_status=='REJECTED' %}selected{% endif %}>REJECTED</option>
        <option value="HOLD" {% if lot.qa_status=='HOLD' %}selected{% endif %}>HOLD</option>
      </select>

      <label>Remarks</label>
      <input type="text" name="remarks" value="{{ lot.qa_remarks or '' }}">
    </div>

    <button class="btn" type="submit">Save</button>
  </form>
</body>
</html>
