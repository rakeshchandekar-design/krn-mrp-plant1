{% extends "base.html" %}
{% block content %}
{% set admin = request.state.role is defined and request.state.role|string == 'admin' %}

<h1>Grinding & Screening</h1>

<div class="grid-2">
  <div class="card">
    <h3>KPIs (Today)</h3>
    <table class="table small">
      <tr><th>Lots Today</th><td>{{ lots_today }}</td></tr>
      <tr><th>Produced Today (kg)</th><td>{{ '%.0f'|format(produced_today or 0) }}</td></tr>
      <tr><th>Oversize Today (kg)</th><td>{{ '%.0f'|format(oversize_today or 0) }}</td></tr>
      {% if admin %}
        <tr><th>Avg Cost Today (₹/kg)</th><td>{{ '%.2f'|format(avg_cost_today or 0) }}</td></tr>
        <tr><th>Weighted Cost Today (₹/kg)</th><td>{{ '%.2f'|format(weighted_cost_today or 0) }}</td></tr>
      {% endif %}
    </table>
  </div>

  <div class="card">
    <h3>Production — Last 5 Days</h3>
    <table class="table small">
      <tr><th>Date</th><th>Actual (kg)</th></tr>
      {% for r in last5 %}
        <tr><td>{{ r.date }}</td><td>{{ '%.0f'|format(r.qty or 0) }}</td></tr>
      {% endfor %}
    </table>
  </div>
</div>

<div class="grid-2" style="margin-top:12px">
  <div class="card">
    <h3>Live Stock — Lots Available</h3>
    <table class="table small">
      <tr><th>Grade</th><th>Qty (kg)</th></tr>
      {% for s in live_stock %}
        <tr><td>{{ s.grade }}</td><td>{{ '%.0f'|format(s.qty or 0) }}</td></tr>
      {% endfor %}
    </table>
  </div>
  <div></div>
</div>

<div class="toolbar" style="margin-top:10px">
  <a class="btn btn-primary" href="/grind/create">Create Lot</a>
  <a class="btn" href="/grind/lots">View Lots</a>
</div>
{% endblock %}
