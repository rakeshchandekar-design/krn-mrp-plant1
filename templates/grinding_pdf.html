{% extends "base.html" %}
{% block content %}
<style>
  @media print { .no-print { display:none } }
  .right { text-align:right }
  .muted { color:#6b7280 }
  .card { border:1px solid #e5e7eb; border-radius:8px; padding:10px; margin:10px 0 }
  table { border-collapse:collapse; width:100% }
  th, td { border:1px solid #e5e7eb; padding:6px 8px; text-align:left }
  th.right, td.right { text-align:right }
</style>

<h2>Grinding Lot Report — {{ header.lot_no }}</h2>
<p class="muted">
  Date: {{ header.date }} |
  Grade: {{ header.grade }} |
  Weight: {{ '%.0f'|format(header.weight_kg or 0) }} kg |
  Oversize: {{ '%.2f'|format((header.oversize_p80_kg or 0)+(header.oversize_p40_kg or 0)) }} kg
</p>

<div class="card">
  <h3 style="margin:0 0 6px 0;">Cost Summary</h3>
  <table style="width:auto">
    <tr><th>Input (Anneal) Cost/kg</th><td class="right">₹{{ '%.2f'|format(header.input_cost_per_kg or 0) }}</td></tr>
    <tr><th>Process Cost/kg</th><td class="right">₹{{ '%.2f'|format(header.process_cost_per_kg or 0) }}</td></tr>
    <tr><th>Final Cost/kg</th><td class="right">₹{{ '%.2f'|format(header.cost_per_kg or 0) }}</td></tr>
  </table>
</div>

<div class="card">
  <h3 style="margin:0 0 6px 0;">Anneal Allocations</h3>
  <table>
    <tr><th>Anneal Lot</th><th>Grade</th><th class="right">Qty (kg)</th><th class="right">Anneal Cost/kg (₹)</th><th class="right">Value (₹)</th></tr>
    {% for r in anneal_rows %}
      {% set row_val = (r.allocated_kg or 0) * (r.anneal_cost_per_kg or 0) %}
      <tr>
        <td>{{ r.anneal_lot_no }}</td>
        <td>{{ r.anneal_grade }}</td>
        <td class="right">{{ '%.2f'|format(r.allocated_kg or 0) }}</td>
        <td class="right">{{ '%.2f'|format(r.anneal_cost_per_kg or 0) }}</td>
        <td class="right">{{ '%.2f'|format(row_val) }}</td>
      </tr>
    {% endfor %}
  </table>
</div>

<div class="card">
  <h3 style="margin:0 0 6px 0;">QA</h3>
  <table style="width:auto">
    <tr><th>Status</th><td>{{ qa and qa.header.decision or '' }}</td></tr>
    <tr><th>Oxygen</th><td>{{ (qa and qa.header and qa.header.oxygen) and ('%.2f'|format(qa.header.oxygen)) or '' }}</td></tr>
    <tr><th>Compressibility</th><td>{{ (qa and qa.header and qa.header.compressibility) and ('%.2f'|format(qa.header.compressibility)) or '' }}</td></tr>
    <tr><th>Remarks</th><td>{{ qa and qa.header.remarks or '' }}</td></tr>
  </table>
</div>

<p class="no-print"><button class="btn" onclick="window.print()">Print / Save as PDF</button></p>
{% endblock %}
