{% extends "base.html" %}
{% block content %}
<h2>Create Annealing Lot (Allocate from Approved RAP)</h2>

<div class="toolbar" style="margin-bottom:10px">
  <a class="btn" href="/anneal/">← Back to Annealing</a>
</div>

<form method="post">
  <label>Lot Weight (kg)</label>
  <input type="number" step="0.01" name="lot_weight" value="0" required>

  <label>Ammonia used (kg)</label>
  <input type="number" step="0.01" name="ammonia_kg" value="0" required>

  <table class="table">
    <tr>
      <th>RAP Lot</th><th>RAP Grade</th><th>Available (kg)</th>
      <th>RAP Cost/kg (₹)</th><th>Allocate (kg)</th>
    </tr>
    {% for r in rap_rows %}
    <tr class="
        {% if r.grade.startswith('KRIP') %} bg-info-subtle
        {% elif r.grade.startswith('KRFS') %} bg-warning-subtle
        {% endif %}
    ">
      <td>{{ r.lot_no }}</td>
      <td>{{ r.grade }}</td>
      <td>{{ '%.1f'|format(r.available_kg) }}</td>
      <td>{{ '%.2f'|format(r.cost_per_kg or 0) }}</td>
      <td><input type="number" step="0.01" min="0" max="{{ r.available_kg }}" name="alloc_{{ r.lot_no }}"></td>
    </tr>
    {% endfor %}
  </table>

  <p class="muted">
    Cost rule: <strong>Anneal Cost/kg = Weighted RAP Cost/kg + ₹10</strong>.  
    KRIP → KIP, KRFS → KFS.
  </p>
  <button class="btn btn-primary" type="submit">Create Lot</button>
</form>

<style>
  .bg-info-subtle { background-color: #e6f4ff; }     /* Light blue */
  .bg-warning-subtle { background-color: #fff3e0; }  /* Light orange */
</style>
{% endblock %}
