<!doctype html><html><body>
{% include "_base_top.html" %}
<div style="padding:16px">
  <h2>Melting</h2>

  <form method="get" action="/melting" style="margin:10px 0;">
    From: <input type="date" name="from_date" value="{{from_date}}">
    To: <input type="date" name="to_date" value="{{to_date}}">
    <button>Filter</button>
  </form>

  {% if role in ["ADMIN","RAP"] %}
  <h3>Create Heat</h3>
  <form method="post" action="/melting/new" style="display:grid;grid-template-columns:repeat(2, minmax(220px,1fr));gap:10px;max-width:680px;">
    <div><label>Notes</label><br><input name="notes"></div>
    <div><label>Slag Qty (kg) *</label><br><input type="number" step="0.1" name="slag_qty" required></div>

    {% for i in [1,2,3,4] %}
    <div>
      <label>RM {{i}} {% if i<=2 %}*{% endif %}</label><br>
      <select name="rm_type_{{i}}"><option value="">--</option>{% for t in rm_types %}<option>{{t}}</option>{% endfor %}</select>
    </div>
    <div>
      <label>Qty {{i}} (kg) {% if i<=2 %}*{% endif %}</label><br>
      <input type="number" step="0.1" name="rm_qty_{{i}}">
    </div>
    {% endfor %}
    <div style="grid-column:1 / -1;"><button>Create Heat</button></div>
  </form>
  {% endif %}

  <h3>Heats</h3>
  <table border="1" cellpadding="6" cellspacing="0">
    <tr>
      <th>Heat No</th><th>Type</th><th>Input</th><th>Output</th><th>QA</th>
      {% if role == "ADMIN" %}<th>Cost (RM + Process = Unit)</th>{% endif %}
      <th>Actions</th>
    </tr>
    {% for h in pending %}
    <tr>
      <td>{{h.heat_no}}</td>
      <td>{% if heat_grades[h.id]=="KRFS" %}<span style="background:#0bf;color:#fff;padding:2px 6px;border-radius:10px;">KRFS (FeSi)</span>{% else %}<span style="background:#0a5;color:#fff;padding:2px 6px;border-radius:10px;">KRIP</span>{% endif %}</td>
      <td>{{"%.1f"|format(h.total_inputs)}} kg</td>
      <td>{{"%.1f"|format(h.actual_output)}} kg</td>
      <td>{{h.qa_status}}</td>
      {% if role == "ADMIN" %}
      <td>₹{{"%.2f"|format(h.rm_cost)}} + ₹{{"%.2f"|format(h.process_cost)}} = ₹{{"%.2f"|format(h.unit_cost)}}</td>
      {% endif %}
      <td><a href="/qa/heat/{{h.id}}">QA</a></td>
    </tr>
    {% endfor %}
  </table>
</div>
</body></html>
